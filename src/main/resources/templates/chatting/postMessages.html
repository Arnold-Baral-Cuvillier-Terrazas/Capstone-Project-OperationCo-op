<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>View all Messages using AJAX</title>
    <nav th:replace="partials/navbar :: navbar"></nav>
    <link th:replace="partials/links :: links"/>

</head>
<body>
<h1>Lets Chat !!</h1>
<div id="messages">
    <div class="container" id="container" style="overflow-y:scroll;">
        <div id="reverse-messages">

        </div>

    </div>
    <form th:action="@{/posts/submit}" th:method="post" th:object="${post}">
        <textarea class="form-control" th:field="*{message_body}" cols="72" rows="5"></textarea>
        <br/>
        <input type="submit"/>
    </form>
</div>

<!--  AJAX request -->
<script type="text/javascript">
    (function($) {
        const request = $.ajax({'url': '/posts.json'});
        request.done(function (posts) {
            var html = '';
            posts.forEach(function(post) {
                html += '<div>';
                html += '<h1>' + post.parent_post_id + '</h1>';
                html += '<p>' + post.message_body + '</p>';
                html += '<p> written by ' + post.user.username + '</p>';
                html += '</div>';
            });
            $('#posts').html(html);
        });
    })(jQuery);

</script>
<div th:replace="partials/scripts :: scripts"></div>
</body>
</html>