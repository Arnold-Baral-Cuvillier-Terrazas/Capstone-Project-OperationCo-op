<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>View all Messages using AJAX</title>
    <div th:replace="partials/links :: links"></div>
    <nav th:replace="partials/navbar :: navbar"></nav>
    <link th:replace="partials/links :: links"/>

</head>
<body>
<h1>Lets Chat !!</h1>
<div id="messages">
    <div class="container" id="container" style="overflow-y:scroll;">
        <div id="reverse-messages">

        </div>

    </div>
    <form th:action="@{/messages/submit}" th:method="post" th:object="${post}">
        <textarea class="form-control" th:field="*{messageBody}" cols="72" rows="5"></textarea>
        <br/>
        <input type="submit"/>
    </form>
</div>

<!-- include the JS file with the AJAX request -->
<script type="text/javascript">
    (function ($) {
        var request = $.ajax({'url': '/messages.json'});
        request.done(function (messages) {
            var html = '';
            messages.forEach(function (message) {
                html += '<div class="message-container">';
                html += '<p class="name">' + message.owner.firstName + ' ' + message.owner.lastName +
                    '  <span class="time">' + message.createTime + '</span></p>';
                html += '<p>' + message.body + '</p>';
                html += '</div>';
            });
            $('#container div').html(html);
        });
    })(jQuery);

</script>
<div th:replace="partials/scripts :: scripts"></div>
</body>
</html>